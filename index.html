<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2563eb">
    <title>ArmoireMaline - D√©tection d'outils manquants</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 20px;
        }

        header h1 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .subtitle { color: var(--text-light); font-size: 1rem; }

        /* Steps indicator */
        .steps {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--surface);
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--text-light);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .step.active {
            background: var(--primary);
            color: white;
        }

        .step.done {
            background: var(--success);
            color: white;
        }

        .step-num {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .card h3 { margin-bottom: 12px; }
        .card .desc { color: var(--text-light); font-size: 0.9rem; margin-bottom: 16px; }

        .hidden { display: none !important; }

        /* Drop zone */
        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .drop-zone:hover, .drop-zone.dragover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .drop-icon { font-size: 2.5rem; margin-bottom: 8px; }

        /* Drawing canvas */
        .drawing-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }

        .drawing-container img {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 8px;
            display: block;
        }

        .drawing-container canvas {
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 8px;
            cursor: crosshair;
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 4px;
            background: var(--bg);
            border-radius: 8px;
        }

        .tool-btn {
            padding: 8px 12px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .tool-btn:hover { background: var(--border); }
        .tool-btn.active { background: var(--primary); color: white; }

        .color-picker {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            padding: 2px;
        }

        .stroke-width {
            width: 80px;
            height: 36px;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0 8px;
        }

        .zones-count {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            background: var(--text-light);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover { background: var(--bg); }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        /* Results */
        .summary-card {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .summary-card.success { background: rgba(16, 185, 129, 0.1); border: 2px solid var(--success); }
        .summary-card.warning { background: rgba(245, 158, 11, 0.1); border: 2px solid var(--warning); }
        .summary-card.danger { background: rgba(239, 68, 68, 0.1); border: 2px solid var(--danger); }

        .summary-icon { font-size: 3rem; }
        .missing-count { font-size: 2.5rem; font-weight: 700; }
        .missing-label { color: var(--text-light); display: block; }

        .result-image {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .zones-list {
            margin-top: 16px;
            padding: 16px;
            background: var(--bg);
            border-radius: 8px;
        }

        .zones-list h4 { margin-bottom: 12px; }

        .zone-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--surface);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .zone-item.missing { border-left: 4px solid var(--danger); }
        .zone-item.present { border-left: 4px solid var(--success); }

        .zone-status {
            font-size: 0.85rem;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .zone-status.missing { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .zone-status.present { background: rgba(16, 185, 129, 0.1); color: var(--success); }

        /* Loading */
        .loading {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading.visible { display: flex; }

        .spinner {
            width: 50px; height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading p { margin-top: 16px; color: var(--text-light); }

        footer {
            text-align: center;
            padding: 24px;
            color: var(--text-light);
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            header h1 { font-size: 1.6rem; }
            .steps { gap: 4px; }
            .step { padding: 6px 10px; font-size: 0.8rem; }
            .toolbar { justify-content: center; }
            .btn { padding: 10px 16px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß ArmoireMaline</h1>
            <p class="subtitle">Entourez vos outils, puis v√©rifiez s'ils sont toujours l√†</p>
        </header>

        <!-- Steps indicator -->
        <div class="steps">
            <div class="step active" id="step1">
                <span class="step-num">1</span>
                <span>Photo r√©f√©rence</span>
            </div>
            <div class="step" id="step2">
                <span class="step-num">2</span>
                <span>Entourer outils</span>
            </div>
            <div class="step" id="step3">
                <span class="step-num">3</span>
                <span>Photo actuelle</span>
            </div>
            <div class="step" id="step4">
                <span class="step-num">4</span>
                <span>R√©sultats</span>
            </div>
        </div>

        <main>
            <!-- √âTAPE 1: Upload r√©f√©rence -->
            <section class="card" id="section1">
                <h3>üì∏ √âtape 1 : Chargez la photo de r√©f√©rence</h3>
                <p class="desc">Prenez une photo de votre armoire avec tous les outils en place</p>
                <div class="drop-zone" id="refDrop">
                    <input type="file" id="refInput" accept="image/*" capture="environment" hidden>
                    <span class="drop-icon">üìÅ</span>
                    <p>Cliquez ou glissez une image</p>
                </div>
            </section>

            <!-- √âTAPE 2: Dessiner les zones -->
            <section class="card hidden" id="section2">
                <h3>‚úèÔ∏è √âtape 2 : Entourez chaque outil</h3>
                <p class="desc">Dessinez un rectangle autour de chaque outil que vous voulez surveiller</p>

                <div class="toolbar">
                    <div class="toolbar-group">
                        <button class="tool-btn active" id="toolRect" title="Rectangle">‚ñ¢</button>
                        <button class="tool-btn" id="toolUndo" title="Annuler">‚Ü©Ô∏è</button>
                        <button class="tool-btn" id="toolClear" title="Tout effacer">üóëÔ∏è</button>
                    </div>
                    <div class="toolbar-group">
                        <input type="color" class="color-picker" id="colorPicker" value="#00ff00" title="Couleur">
                        <select class="stroke-width" id="strokeWidth" title="√âpaisseur">
                            <option value="2">Fine</option>
                            <option value="4" selected>Moyenne</option>
                            <option value="6">√âpaisse</option>
                        </select>
                    </div>
                    <div class="zones-count" id="zonesCount">0 zone(s)</div>
                </div>

                <div class="drawing-container" id="drawingContainer">
                    <img id="refImage" alt="R√©f√©rence">
                    <canvas id="drawCanvas"></canvas>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" id="backToStep1">‚Üê Retour</button>
                    <button class="btn btn-primary" id="goToStep3" disabled>Continuer ‚Üí</button>
                </div>
            </section>

            <!-- √âTAPE 3: Upload actuelle -->
            <section class="card hidden" id="section3">
                <h3>üì∑ √âtape 3 : Chargez la photo actuelle</h3>
                <p class="desc">Prenez une nouvelle photo de l'armoire pour v√©rifier les outils</p>
                <div class="drop-zone" id="curDrop">
                    <input type="file" id="curInput" accept="image/*" capture="environment" hidden>
                    <span class="drop-icon">üìÅ</span>
                    <p>Cliquez ou glissez une image</p>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" id="backToStep2">‚Üê Retour</button>
                </div>
            </section>

            <!-- √âTAPE 4: R√©sultats -->
            <section class="card hidden" id="section4">
                <h3>üìä R√©sultats de l'analyse</h3>

                <div class="summary-card" id="summary">
                    <div class="summary-icon" id="summaryIcon">‚úÖ</div>
                    <div>
                        <span class="missing-count" id="missingCount">0</span>
                        <span class="missing-label">outil(s) manquant(s)</span>
                    </div>
                </div>

                <canvas id="resultCanvas" class="result-image"></canvas>

                <div class="zones-list" id="zonesList">
                    <h4>D√©tail des zones :</h4>
                    <div id="zonesDetail"></div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" id="backToStep3">‚Üê Nouvelle photo</button>
                    <button class="btn btn-primary" id="restart">üîÑ Recommencer</button>
                </div>
            </section>
        </main>

        <footer>
            <p>ArmoireMaline v1.0 - D√©tection manuelle d'outils</p>
        </footer>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Analyse en cours...</p>
    </div>

    <script>
        // √âtat de l'application
        const state = {
            refImageData: null,
            curImageData: null,
            zones: [], // Liste des rectangles dessin√©s {x, y, width, height}
            currentStep: 1
        };

        // Variables de dessin
        let isDrawing = false;
        let startX, startY;
        let canvasCtx;
        let imgWidth, imgHeight;
        let scale = 1;

        // √âl√©ments DOM
        const els = {
            steps: [null, document.getElementById('step1'), document.getElementById('step2'),
                    document.getElementById('step3'), document.getElementById('step4')],
            sections: [null, document.getElementById('section1'), document.getElementById('section2'),
                       document.getElementById('section3'), document.getElementById('section4')],
            refDrop: document.getElementById('refDrop'),
            refInput: document.getElementById('refInput'),
            refImage: document.getElementById('refImage'),
            drawCanvas: document.getElementById('drawCanvas'),
            drawingContainer: document.getElementById('drawingContainer'),
            colorPicker: document.getElementById('colorPicker'),
            strokeWidth: document.getElementById('strokeWidth'),
            zonesCount: document.getElementById('zonesCount'),
            goToStep3: document.getElementById('goToStep3'),
            curDrop: document.getElementById('curDrop'),
            curInput: document.getElementById('curInput'),
            resultCanvas: document.getElementById('resultCanvas'),
            summary: document.getElementById('summary'),
            summaryIcon: document.getElementById('summaryIcon'),
            missingCount: document.getElementById('missingCount'),
            zonesDetail: document.getElementById('zonesDetail'),
            loading: document.getElementById('loading')
        };

        // Navigation entre √©tapes
        function goToStep(step) {
            state.currentStep = step;

            // Mise √† jour des indicateurs
            for (let i = 1; i <= 4; i++) {
                els.steps[i].classList.remove('active', 'done');
                if (i < step) els.steps[i].classList.add('done');
                else if (i === step) els.steps[i].classList.add('active');
            }

            // Afficher la bonne section
            for (let i = 1; i <= 4; i++) {
                els.sections[i].classList.toggle('hidden', i !== step);
            }
        }

        // √âTAPE 1: Charger image r√©f√©rence
        els.refDrop.addEventListener('click', () => els.refInput.click());
        els.refDrop.addEventListener('dragover', e => { e.preventDefault(); els.refDrop.classList.add('dragover'); });
        els.refDrop.addEventListener('dragleave', () => els.refDrop.classList.remove('dragover'));
        els.refDrop.addEventListener('drop', e => {
            e.preventDefault();
            els.refDrop.classList.remove('dragover');
            if (e.dataTransfer.files[0]) loadRefImage(e.dataTransfer.files[0]);
        });
        els.refInput.addEventListener('change', e => {
            if (e.target.files[0]) loadRefImage(e.target.files[0]);
        });

        function loadRefImage(file) {
            const reader = new FileReader();
            reader.onload = e => {
                state.refImageData = e.target.result;
                state.zones = [];
                setupDrawingCanvas();
                goToStep(2);
            };
            reader.readAsDataURL(file);
        }

        // √âTAPE 2: Configuration du canvas de dessin
        function setupDrawingCanvas() {
            const img = els.refImage;
            img.onload = () => {
                imgWidth = img.naturalWidth;
                imgHeight = img.naturalHeight;

                // Calculer l'√©chelle d'affichage
                const displayWidth = img.clientWidth;
                const displayHeight = img.clientHeight;
                scale = displayWidth / imgWidth;

                // Configurer le canvas
                els.drawCanvas.width = displayWidth;
                els.drawCanvas.height = displayHeight;
                canvasCtx = els.drawCanvas.getContext('2d');

                redrawZones();
            };
            img.src = state.refImageData;
        }

        // √âv√©nements de dessin
        els.drawCanvas.addEventListener('mousedown', startDraw);
        els.drawCanvas.addEventListener('mousemove', drawing);
        els.drawCanvas.addEventListener('mouseup', endDraw);
        els.drawCanvas.addEventListener('mouseleave', endDraw);

        // Touch events pour mobile
        els.drawCanvas.addEventListener('touchstart', e => {
            e.preventDefault();
            const touch = e.touches[0];
            startDraw({ clientX: touch.clientX, clientY: touch.clientY });
        });
        els.drawCanvas.addEventListener('touchmove', e => {
            e.preventDefault();
            const touch = e.touches[0];
            drawing({ clientX: touch.clientX, clientY: touch.clientY });
        });
        els.drawCanvas.addEventListener('touchend', e => {
            e.preventDefault();
            endDraw();
        });

        function getCanvasCoords(e) {
            const rect = els.drawCanvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        function startDraw(e) {
            const coords = getCanvasCoords(e);
            isDrawing = true;
            startX = coords.x;
            startY = coords.y;
        }

        function drawing(e) {
            if (!isDrawing) return;
            const coords = getCanvasCoords(e);

            redrawZones();

            // Dessiner le rectangle en cours
            canvasCtx.strokeStyle = els.colorPicker.value;
            canvasCtx.lineWidth = parseInt(els.strokeWidth.value);
            canvasCtx.strokeRect(startX, startY, coords.x - startX, coords.y - startY);
        }

        function endDraw(e) {
            if (!isDrawing) return;
            isDrawing = false;

            if (!e) return;
            const coords = getCanvasCoords(e);

            const width = coords.x - startX;
            const height = coords.y - startY;

            // Ignorer les rectangles trop petits
            if (Math.abs(width) > 20 && Math.abs(height) > 20) {
                // Normaliser le rectangle (g√©rer les directions n√©gatives)
                const zone = {
                    x: Math.min(startX, coords.x) / scale,
                    y: Math.min(startY, coords.y) / scale,
                    width: Math.abs(width) / scale,
                    height: Math.abs(height) / scale,
                    color: els.colorPicker.value
                };
                state.zones.push(zone);
                updateZonesCount();
            }

            redrawZones();
        }

        function redrawZones() {
            canvasCtx.clearRect(0, 0, els.drawCanvas.width, els.drawCanvas.height);

            state.zones.forEach((zone, index) => {
                canvasCtx.strokeStyle = zone.color;
                canvasCtx.lineWidth = parseInt(els.strokeWidth.value);
                canvasCtx.strokeRect(
                    zone.x * scale,
                    zone.y * scale,
                    zone.width * scale,
                    zone.height * scale
                );

                // Num√©ro de la zone
                canvasCtx.fillStyle = zone.color;
                canvasCtx.font = 'bold 16px sans-serif';
                canvasCtx.fillText(`${index + 1}`, zone.x * scale + 5, zone.y * scale + 18);
            });
        }

        function updateZonesCount() {
            els.zonesCount.textContent = `${state.zones.length} zone(s)`;
            els.goToStep3.disabled = state.zones.length === 0;
        }

        // Boutons de la barre d'outils
        document.getElementById('toolUndo').addEventListener('click', () => {
            state.zones.pop();
            redrawZones();
            updateZonesCount();
        });

        document.getElementById('toolClear').addEventListener('click', () => {
            state.zones = [];
            redrawZones();
            updateZonesCount();
        });

        // Navigation
        document.getElementById('backToStep1').addEventListener('click', () => goToStep(1));
        document.getElementById('goToStep3').addEventListener('click', () => goToStep(3));
        document.getElementById('backToStep2').addEventListener('click', () => goToStep(2));
        document.getElementById('backToStep3').addEventListener('click', () => goToStep(3));
        document.getElementById('restart').addEventListener('click', () => {
            state.refImageData = null;
            state.curImageData = null;
            state.zones = [];
            goToStep(1);
        });

        // √âTAPE 3: Charger image actuelle
        els.curDrop.addEventListener('click', () => els.curInput.click());
        els.curDrop.addEventListener('dragover', e => { e.preventDefault(); els.curDrop.classList.add('dragover'); });
        els.curDrop.addEventListener('dragleave', () => els.curDrop.classList.remove('dragover'));
        els.curDrop.addEventListener('drop', e => {
            e.preventDefault();
            els.curDrop.classList.remove('dragover');
            if (e.dataTransfer.files[0]) loadCurImage(e.dataTransfer.files[0]);
        });
        els.curInput.addEventListener('change', e => {
            if (e.target.files[0]) loadCurImage(e.target.files[0]);
        });

        function loadCurImage(file) {
            const reader = new FileReader();
            reader.onload = e => {
                state.curImageData = e.target.result;
                analyzeZones();
            };
            reader.readAsDataURL(file);
        }

        // √âTAPE 4: Analyse des zones
        async function analyzeZones() {
            els.loading.classList.add('visible');

            await new Promise(r => setTimeout(r, 100));

            try {
                // Charger les deux images
                const refImg = await loadImageAsync(state.refImageData);
                const curImg = await loadImageAsync(state.curImageData);

                // Cr√©er des canvas pour l'analyse
                const refCanvas = document.createElement('canvas');
                const curCanvas = document.createElement('canvas');

                refCanvas.width = refImg.width;
                refCanvas.height = refImg.height;
                curCanvas.width = refImg.width;
                curCanvas.height = refImg.height;

                const refCtx = refCanvas.getContext('2d');
                const curCtx = curCanvas.getContext('2d');

                refCtx.drawImage(refImg, 0, 0);
                curCtx.drawImage(curImg, 0, 0, refImg.width, refImg.height);

                // Analyser chaque zone
                const results = [];
                const threshold = 35; // Seuil de diff√©rence

                for (let i = 0; i < state.zones.length; i++) {
                    const zone = state.zones[i];

                    // Extraire les pixels de la zone
                    const refData = refCtx.getImageData(zone.x, zone.y, zone.width, zone.height);
                    const curData = curCtx.getImageData(zone.x, zone.y, zone.width, zone.height);

                    // Calculer la diff√©rence moyenne
                    let totalDiff = 0;
                    let pixelCount = refData.data.length / 4;

                    for (let p = 0; p < refData.data.length; p += 4) {
                        const rDiff = Math.abs(refData.data[p] - curData.data[p]);
                        const gDiff = Math.abs(refData.data[p+1] - curData.data[p+1]);
                        const bDiff = Math.abs(refData.data[p+2] - curData.data[p+2]);
                        totalDiff += (rDiff + gDiff + bDiff) / 3;
                    }

                    const avgDiff = totalDiff / pixelCount;
                    const isMissing = avgDiff > threshold;

                    results.push({
                        zone: zone,
                        index: i + 1,
                        avgDiff: avgDiff,
                        isMissing: isMissing
                    });
                }

                // Afficher les r√©sultats
                displayResults(results, curImg, refImg.width, refImg.height);
                goToStep(4);

            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de l\'analyse: ' + error.message);
            }

            els.loading.classList.remove('visible');
        }

        function loadImageAsync(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }

        function displayResults(results, curImg, width, height) {
            const missingCount = results.filter(r => r.isMissing).length;

            // R√©sum√©
            els.missingCount.textContent = missingCount;
            els.summary.className = 'summary-card';

            if (missingCount === 0) {
                els.summary.classList.add('success');
                els.summaryIcon.textContent = '‚úÖ';
            } else if (missingCount <= 2) {
                els.summary.classList.add('warning');
                els.summaryIcon.textContent = '‚ö†Ô∏è';
            } else {
                els.summary.classList.add('danger');
                els.summaryIcon.textContent = 'üö®';
            }

            // Dessiner le r√©sultat
            els.resultCanvas.width = width;
            els.resultCanvas.height = height;
            const ctx = els.resultCanvas.getContext('2d');
            ctx.drawImage(curImg, 0, 0, width, height);

            // Dessiner les zones
            results.forEach(r => {
                const zone = r.zone;

                if (r.isMissing) {
                    // Zone manquante : rouge
                    ctx.strokeStyle = '#ef4444';
                    ctx.fillStyle = 'rgba(239, 68, 68, 0.3)';
                    ctx.lineWidth = 4;
                } else {
                    // Zone pr√©sente : vert
                    ctx.strokeStyle = '#10b981';
                    ctx.fillStyle = 'rgba(16, 185, 129, 0.2)';
                    ctx.lineWidth = 3;
                }

                ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                ctx.strokeRect(zone.x, zone.y, zone.width, zone.height);

                // Num√©ro et statut
                ctx.fillStyle = r.isMissing ? '#ef4444' : '#10b981';
                ctx.font = 'bold 20px sans-serif';
                ctx.fillText(
                    `${r.index} ${r.isMissing ? '‚úó' : '‚úì'}`,
                    zone.x + 5,
                    zone.y + 24
                );
            });

            // Liste d√©taill√©e
            els.zonesDetail.innerHTML = results.map(r => `
                <div class="zone-item ${r.isMissing ? 'missing' : 'present'}">
                    <span>Zone ${r.index}</span>
                    <span class="zone-status ${r.isMissing ? 'missing' : 'present'}">
                        ${r.isMissing ? '‚ùå Manquant' : '‚úÖ Pr√©sent'}
                    </span>
                </div>
            `).join('');
        }

        // Initialisation
        goToStep(1);
    </script>
</body>
</html>
